syntax = "proto3";

package api.datastore.v1;

option go_package = "github.com/smartcontractkit/chainlink-protos/op-catalog/v1/datastore";

import "google/protobuf/any.proto";
import "op-catalog/v1/datastore/address_reference.proto";
import "op-catalog/v1/datastore/contract_metadata.proto";
import "op-catalog/v1/datastore/chain_metadata.proto";
import "op-catalog/v1/datastore/environment_metadata.proto";
import "op-catalog/v1/datastore/transactions.proto";

service Datastore {
  rpc DataAccess (stream DataAccessRequest) returns (stream DataAccessResponse) {}
}

// ResponseStatus provides per-message error information in streaming RPCs.
// Compatible with google.rpc.Status.
message ResponseStatus {
  // The status code, which should be an enum value of google.rpc.Code.
  int32 code = 1;
  
  // A developer-facing error message.
  string message = 2;
  
  // A list of messages that carry the error details.
  // Optional field for additional error context.
  repeated google.protobuf.Any details = 3;
}

message DataAccessRequest {
  reserved 1;
  oneof operation {
    AddressReferenceFindRequest address_reference_find_request = 2;
    AddressReferenceEditRequest address_reference_edit_request = 3;
    ContractMetadataFindRequest contract_metadata_find_request = 4;
    ContractMetadataEditRequest contract_metadata_edit_request = 5;
    ChainMetadataFindRequest chain_metadata_find_request = 6;
    ChainMetadataEditRequest chain_metadata_edit_request = 7;
    EnvironmentMetadataFindRequest environment_metadata_find_request = 8;
    EnvironmentMetadataEditRequest environment_metadata_edit_request = 9;
    BeginTransactionRequest begin_transaction_request = 10;
    CommitTransactionRequest commit_transaction_request = 11;
    RollbackTransactionRequest rollback_transaction_request = 12;
  }
}

message DataAccessResponse {
  ResponseStatus status = 1;
  oneof response {
    AddressReferenceFindResponse address_reference_find_response = 2;
    AddressReferenceEditResponse address_reference_edit_response = 3;
    ContractMetadataFindResponse contract_metadata_find_response = 4;
    ContractMetadataEditResponse contract_metadata_edit_response = 5;
    ChainMetadataFindResponse chain_metadata_find_response = 6;
    ChainMetadataEditResponse chain_metadata_edit_response = 7;
    EnvironmentMetadataFindResponse environment_metadata_find_response = 8;
    EnvironmentMetadataEditResponse environment_metadata_edit_response = 9;
    BeginTransactionResponse begin_transaction_response = 10;
    CommitTransactionResponse commit_transaction_response = 11;
    RollbackTransactionResponse rollback_transaction_response = 12;
  }
}

