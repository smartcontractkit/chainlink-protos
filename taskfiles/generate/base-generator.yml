version: "3"

tasks:
  generator:
    internal: true
    cmds:
      - >
        protoc
        --go_out ./generated/go
        --go_opt paths=source_relative
        --go-grpc_out ./generated/go
        --go-grpc_opt paths=source_relative
        ./{{.SERVICE}}/{{.FILE_NAME}}
      - >
        cd ./generated/go/{{.SERVICE}}/{{.SUB_SERVICE}} && 
        go mod init github.com/smartcontractkit/tooling-protos/{{.SERVICE}}/{{.SUB_SERVICE}} && 
        go mod tidy