syntax = "proto3";

package workflows.v2;

import "google/protobuf/wrappers.proto";

option go_package = "github.com/smartcontractkit/chainlink-protos/workflows/go/v2";

// METADATA

message CreInfo {
  int32 donID = 1;
  int32 donF = 2;
  int32 donN = 3;
  string p2pID = 4;
  string workflowRegistryAddress = 5;
  string workflowRegistryVersion = 6;
  string workflowRegistryChain = 7;
  string engineVersion = 8;
  string capabilitiesRegistryVersion = 9;
  string donVersion = 10;
}

message WorkflowKey {
  string workflowOwner = 1;
  string workflowName  = 2;
  string workflowID    = 3;
  string organizationID = 4;
}


// DEPLOYMENT

message TransactionInfo {
  string chainSelector = 1;
  string txHash = 2;
  string gasCost = 3;
}

message Workflow {
  WorkflowKey workflowKey = 1;
  string version = 2;
  string binaryURL     = 3;
  string configURL     = 4;
}

message WorkflowDeployed {
  CreInfo         creInfo   = 1;
  string          timestamp = 2;
  TransactionInfo txInfo    = 3;

  Workflow                     workflow     = 4;
  google.protobuf.StringValue  errorMessage = 5;  // present ⇔ failure
}

message WorkflowUpdated {
  CreInfo         creInfo   = 1;
  string          timestamp = 2;
  TransactionInfo txInfo    = 3;

  Workflow                     workflow     = 4;
  google.protobuf.StringValue  errorMessage = 5;  // present ⇔ failure
}

message WorkflowDeleted {
  CreInfo         creInfo   = 1;
  string          timestamp = 2;
  TransactionInfo txInfo    = 3;

  Workflow                     workflow     = 4;
  google.protobuf.StringValue  errorMessage = 5;  // present ⇔ failure
}


// EXECUTION

enum ExecutionStatus {
  SUCCEEDED = 0;
  FAILED = 1;
}

message TriggerExecutionStarted {
  CreInfo creInfo = 1;
  WorkflowKey workflow = 2;
  string workflowExecutionID = 3;
  string timestamp = 4;

  string triggerID = 5;
}

message WorkflowExecutionStarted {
  CreInfo creInfo = 1;
  WorkflowKey workflow = 2;
  string workflowExecutionID = 3;
  string timestamp = 4;

  string triggerID = 5;
}

message WorkflowExecutionFinished {
  CreInfo creInfo = 1;
  WorkflowKey workflow = 2;
  string workflowExecutionID = 3;
  string timestamp = 4;

  ExecutionStatus status = 5;
}

message CapabilityExecutionStarted {
  CreInfo creInfo = 1;
  WorkflowKey workflow = 2;
  string workflowExecutionID = 3;
  string timestamp = 4;

  string capabilityID = 5;
  int32 stepRef = 6;
}

message CapabilityExecutionFinished {
  CreInfo creInfo = 1;
  WorkflowKey workflow = 2;
  string workflowExecutionID = 3;
  string timestamp = 4;

  string capabilityID = 5;
  int32 stepRef = 6;
  ExecutionStatus status = 7;
}
