syntax = "proto3";

package chainlink_ccv.committee_verifier.v1;

import "verifier/v1/verifier.proto";
import "google/rpc/status.proto";

option go_package = "github.com/smartcontractkit/chainlink-protos/chainlink-ccv/committee-verifier/v1";

service CommitteeVerifier {
  rpc WriteCommitteeVerifierNodeResult(WriteCommitteeVerifierNodeResultRequest) returns (WriteCommitteeVerifierNodeResultResponse);
  rpc BatchWriteCommitteeVerifierNodeResult(BatchWriteCommitteeVerifierNodeResultRequest) returns (BatchWriteCommitteeVerifierNodeResultResponse);
  rpc ReadCommitteeVerifierNodeResult(ReadCommitteeVerifierNodeResultRequest) returns (ReadCommitteeVerifierNodeResultResponse);
  rpc WriteChainStatus(WriteChainStatusRequest) returns (WriteChainStatusResponse);
  rpc ReadChainStatus(ReadChainStatusRequest) returns (ReadChainStatusResponse);
}

enum WriteStatus {
  SUCCESS = 0;
  FAILED = 1;
}

message ChainStatus {
  uint64 chain_selector = 1;
  uint64 finalized_block_height = 2;
  bool disabled = 3;
}

message CommitteeVerifierNodeResult {
  chainlink_ccv.verifier.v1.Message message = 1;
  bytes ccv_version = 2;
  repeated bytes ccv_addresses = 3;
  bytes executor_address = 4; 
  bytes signature = 5;
}

message WriteChainStatusRequest {
  repeated ChainStatus statuses = 1;
}

message WriteChainStatusResponse {
  WriteStatus status = 1;
}

message ReadChainStatusRequest {
  repeated uint64 chain_selectors = 1;
}

message ReadChainStatusResponse {
  repeated ChainStatus statuses = 1;
}

message BatchWriteCommitteeVerifierNodeResultRequest {
  repeated WriteCommitteeVerifierNodeResultRequest requests = 1;
}

message BatchWriteCommitteeVerifierNodeResultResponse {
  repeated WriteCommitteeVerifierNodeResultResponse responses = 1;
  repeated google.rpc.Status errors = 2;
}

message WriteCommitteeVerifierNodeResultRequest {
  CommitteeVerifierNodeResult committee_verifier_node_result = 1;
}

message WriteCommitteeVerifierNodeResultResponse {
  WriteStatus status = 1;
}

message ReadCommitteeVerifierNodeResultRequest {
  bytes message_id = 1;
  bytes address = 2;
}

message ReadCommitteeVerifierNodeResultResponse {
  CommitteeVerifierNodeResult committee_verifier_node_result = 1;
}

